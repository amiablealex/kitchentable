{% extends "base.html" %}

{% block title %}Settings - The Kitchen Table{% endblock %}

{% block content %}
<header class="app-header">
    <div class="app-header-top">
        <h1 class="app-title">Kitchen Table</h1>
        <div class="app-header-actions">
            <a href="/table" class="header-btn">‚Üê Back</a>
            <button id="logout-btn" class="header-btn">Logout</button>
        </div>
    </div>
    <div class="table-subtitle">
        <span class="table-subtitle-text">üè†</span>
        <div id="table-switcher-container"></div>
    </div>
</header>

<div class="content-wrapper">
    <section class="settings-section">
        <h2>Your Profile</h2>
        <form id="profile-form" class="settings-form">
            <div class="form-group">
                <label for="display_name">Display Name (for this table)</label>
                <input type="text" id="display_name" name="display_name" 
                       minlength="1" maxlength="50" 
                       placeholder="How others see you">
                <small>This name is only for this kitchen table. You can have different names in different tables.</small>
            </div>
            <div class="info-group">
                <label>Username:</label>
                <p id="username-display"></p>
            </div>
            <div id="profile-message" class="success-message"></div>
            <div id="profile-error" class="error-message"></div>
            <button type="submit" class="btn btn-primary">Save Display Name</button>
        </form>
    </section>

    <section class="settings-section">
        <h2>Table Information</h2>
        <div class="info-group">
            <label>Table Name:</label>
            <p id="table-name-display"></p>
        </div>
        <div class="info-group">
            <label>Daily Question Time:</label>
            <p id="prompt-time-display"></p>
        </div>
        <div class="info-group">
            <label>Invite Code:</label>
            <p id="invite-code-display" class="invite-code"></p>
            <button id="copy-code-btn" class="btn btn-secondary btn-small">Copy Code</button>
        </div>
    </section>
    
    <section class="settings-section" id="owner-settings" style="display: none;">
        <h2>Table Settings <span class="owner-badge">Owner Only</span></h2>
        <form id="settings-form" class="settings-form">
            <div class="form-group">
                <label for="table_name">Table Name</label>
                <input type="text" id="table_name" name="table_name" 
                       minlength="3" maxlength="50">
            </div>
            <div class="form-group">
                <label for="prompt_time">Daily Question Time</label>
                <input type="time" id="prompt_time" name="prompt_time">
                <small>We recommend 5:00 PM (17:00) so everyone has all day to respond.</small>
            </div>
            <div id="settings-message" class="success-message"></div>
            <div id="settings-error" class="error-message"></div>
            <button type="submit" class="btn btn-primary">Save Changes</button>
        </form>
    </section>
    
    <section class="settings-section">
        <h2>Members</h2>
        <div id="members-list" class="members-list">
            <!-- Members will be inserted here -->
        </div>
    </section>
    
    <section class="settings-section danger-zone">
        <h2>Leave Table</h2>
        <p>Once you leave, you'll need an invite code to rejoin.</p>
        <button id="leave-table-btn" class="btn btn-danger">Leave Table</button>
    </section>
    
    <section class="settings-section danger-zone">
        <h2>Delete Account</h2>
        <p>Permanently delete your account and all your data from all tables. This cannot be undone.</p>
        <button id="delete-account-btn" class="btn btn-danger">Delete My Account</button>
    </section>
</div>

<div id="loading-overlay" class="loading-overlay" style="display: none;">
    <div class="loading-spinner"></div>
</div>

<!-- Leave Table Confirmation Modal -->
<div id="leave-modal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
        <h2 style="color: var(--color-brand-primary); margin-bottom: 1rem;">Leave This Table?</h2>
        <p style="margin-bottom: 1.5rem;">You'll need an invite code to rejoin. Are you sure you want to leave?</p>
        <div style="display: flex; gap: 1rem; justify-content: flex-end;">
            <button type="button" id="cancel-leave-btn" class="btn btn-secondary">Cancel</button>
            <button type="button" id="confirm-leave-btn" class="btn btn-danger">Yes, Leave Table</button>
        </div>
    </div>
</div>

<!-- Delete Account Confirmation Modal -->
<div id="delete-modal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
        <h2 style="color: var(--color-brand-primary); margin-bottom: 1rem;">Delete Your Account?</h2>
        <p style="margin-bottom: 1.5rem;">This will permanently delete your account and all your responses from all tables. This action cannot be undone.</p>
        <form id="delete-confirm-form">
            <div class="form-group">
                <label for="delete-password">Enter your password to confirm:</label>
                <input type="password" id="delete-password" name="password" required 
                       placeholder="Your password" style="margin-bottom: 1rem;">
            </div>
            <div id="delete-error" class="error-message"></div>
            <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                <button type="button" id="cancel-delete-btn" class="btn btn-secondary">Cancel</button>
                <button type="submit" class="btn btn-danger">Yes, Delete My Account</button>
            </div>
        </form>
    </div>
</div>

{% endblock %}
